<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Kaydarap</title>
  <meta name="description" content="Kaydarap" />
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#050507" />

  <!-- Google Font: Dancing Script -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#050507;
      --bg1:#0a0b0e;
      --bg2:#101216;
      --fg:#eaeaf0;
      --muted:#a3a3ae;
      --accent:#6bdcff;
      --glow:#6bdcff22;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg);
      background:
        radial-gradient(120% 160% at 50% -10%, var(--bg2) 0%, var(--bg1) 40%, var(--bg0) 100%);
      color-scheme:dark;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed; inset:-40%;
      background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220" viewBox="0 0 220 220"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.05"/></svg>');
      background-size:220px 220px;
      mix-blend-mode:soft-light;
      opacity:.45;
      pointer-events:none;
      animation:grain 60s linear infinite;
    }
    @keyframes grain{to{transform:translate3d(8%,8%,0)}}

    .section{
      min-height:100vh;
      position:relative;
      display:grid;
      place-items:center;
      padding:0 16px;
    }

    .top{
      position:fixed; inset:0 0 auto 0;
      display:flex; align-items:center; gap:.75rem;
      padding:14px 18px calc(env(safe-area-inset-top) + 0px) 18px;
      pointer-events:none;
      z-index:10;
    }
    .brand{
      font-weight:700;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:.95rem;
      color:var(--muted);
      opacity:.9;
      user-select:none;
    }
    .planet-wrap{
      position:relative;
      width:86px; height:86px;
      filter: drop-shadow(0 0 18px var(--glow)) drop-shadow(0 0 48px var(--glow));
      pointer-events:none;
    }
    .planet{
      position:relative;
      width:100%; height:100%;
      border-radius:50%;
      background:
        radial-gradient(120% 120% at 30% 30%, #8ff1ff 0%, #2a9bff 25%, #0f1a3a 55%, #0b0f24 70%, #060810 100%);
      overflow:hidden;
      transform: translateZ(0);
    }
    .planet::before{
      content:"";
      position:absolute; inset:-30%;
      border-radius:50%;
      background: radial-gradient(60% 70% at 20% 25%, rgba(0,0,0,0) 0%, rgba(0,0,0,0.0) 45%, rgba(0,0,0,.55) 70%, rgba(0,0,0,.9) 100%);
      mix-blend-mode:multiply;
    }
    .planet::after{
      content:"";
      position:absolute; inset:-10%;
      border-radius:50%;
      background: conic-gradient(from 0deg, rgba(255,255,255,.08), rgba(255,255,255,0) 30% 100%);
      animation: spin 28s linear infinite;
      mix-blend-mode:screen;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .ring{
      position:absolute; inset:-20%;
      border-radius:50%;
      background: radial-gradient(60% 15% at 50% 50%,
        rgba(140,220,255,.35), rgba(140,220,255,0) 65%);
      transform: rotateX(70deg) rotateZ(-25deg);
      filter: blur(0.6px);
      animation: wobble 9s ease-in-out infinite alternate;
    }
    @keyframes wobble{
      from{ transform: rotateX(68deg) rotateZ(-27deg) }
      to  { transform: rotateX(74deg) rotateZ(-23deg) }
    }

    .hero-title {
      font-family: 'Dancing Script', cursive;
      font-size: clamp(3rem, 12vw, 10rem);
      color: #ffffff;
      text-align: center;
      margin: 0;
      user-select: none;
      text-shadow: 0 4px 25px rgba(0,0,0,0.6);
    }

    .sphere-section{
      min-height:100vh;
      display:block;
      position:relative;
    }
    .title{
      position:absolute; top:32px; left:0; right:0;
      text-align:center;
      font-weight:800;
      letter-spacing:.02em;
      font-size: clamp(1.2rem, 2.8vw, 2rem);
      color:#f4fbff;
      text-shadow: 0 2px 20px rgba(80,170,220,.25);
      user-select:none;
      z-index:2;
    }
    .three-wrap{
      position:absolute; inset:0;
      z-index:1;
      touch-action: none;
    }
    canvas{
      display:block;
      width:100%; height:100%;
    }

    @supports (-webkit-touch-callout: none){
      .sphere-section, .three-wrap { min-height: 100svh; }
    }

    @media (max-width:480px){
      .planet-wrap{ width:72px; height:72px}
      .brand{font-size:.88rem}
    }
  </style>
</head>
<body>
  <div class="top">
    <div class="planet-wrap" aria-hidden="true">
      <div class="planet">
        <div class="ring"></div>
      </div>
    </div>
    <div class="brand">Kaydarap</div>
  </div>

  <section class="section hero">
    <h1 class="hero-title">Kaydarap</h1>
  </section>

  <section class="sphere-section" id="sphere">
    <div class="title">Welcome to Kaydarap Website</div>
    <div class="three-wrap" id="three-container"></div>
  </section>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.157.0/build/three.module.js";

    const container = document.getElementById('three-container');
    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 100);
    camera.position.set(0, 0, 9);

    const group = new THREE.Group();
    scene.add(group);

    const light = new THREE.AmbientLight(0x88ccff, 0.5);
    scene.add(light);

    const R = 3.2;
    const shellCount = 4800;
    const haloCount  = 4800;

    function randomOnSphere(r){
      const u = Math.random();
      const v = Math.random();
      const theta = 2 * Math.PI * v;
      const phi = Math.acos(2*u - 1);
      const sin = Math.sin(phi);
      return new THREE.Vector3(
        r * sin * Math.cos(theta),
        r * Math.cos(phi),
        r * sin * Math.sin(theta)
      );
    }

    const shellPositions = new Float32Array(shellCount * 3);
    for(let i=0;i<shellCount;i++){
      const p = randomOnSphere(R + (Math.random()-0.5)*0.02);
      shellPositions[i*3+0]=p.x;
      shellPositions[i*3+1]=p.y;
      shellPositions[i*3+2]=p.z;
    }
    const shellGeom = new THREE.BufferGeometry();
    shellGeom.setAttribute('position', new THREE.BufferAttribute(shellPositions, 3));
    const shellMat = new THREE.PointsMaterial({
      color: 0x6bdcff,
      size: 0.035,
      sizeAttenuation: true,
      transparent: true,
      opacity: 0.95,
      blending: THREE.AdditiveBlending,
      depthWrite: false
    });
    const shell = new THREE.Points(shellGeom, shellMat);
    group.add(shell);

    const haloPositions = new Float32Array(haloCount * 3);
    for(let i=0;i<haloCount;i++){
      const r = R * (1.04 + Math.random()*0.35);
      const p = randomOnSphere(r);
      haloPositions[i*3+0]=p.x;
      haloPositions[i*3+1]=p.y;
      haloPositions[i*3+2]=p.z;
    }
    const haloGeom = new THREE.BufferGeometry();
    haloGeom.setAttribute('position', new THREE.BufferAttribute(haloPositions, 3));
    const haloMat = new THREE.PointsMaterial({
      color: 0x88eeff,
      size: 0.02,
      sizeAttenuation: true,
      transparent: true,
      opacity: 0.55,
      blending: THREE.AdditiveBlending,
      depthWrite: false
    });
    const halo = new THREE.Points(haloGeom, haloMat);
    group.add(halo);

    const meshGeom = new THREE.SphereGeometry(R*0.995, 32, 22);
    const wireGeom = new THREE.WireframeGeometry(meshGeom);
    const wireMat = new THREE.LineBasicMaterial({
      color: 0x3bb9ff,
      transparent:true,
      opacity:0.35
    });
    const wire = new THREE.LineSegments(wireGeom, wireMat);
    group.add(wire);

    const orbitalGroup = new THREE.Group();
    group.add(orbitalGroup);

    const moonGeom = new THREE.SphereGeometry(0.55, 24, 18);
    const moonWire = new THREE.WireframeGeometry(moonGeom);
    const moon = new THREE.LineSegments(
      moonWire,
      new THREE.LineBasicMaterial({color:0x9be9ff, transparent:true, opacity:.6})
    );
    moon.position.set(R+1.2, 0, 0);
    orbitalGroup.add(moon);

    let targetX = 0, targetY = 0;
    let dragging = false, lastX = 0, lastY = 0;

    function onPointerDown(e){
      dragging = true;
      const p = (e.touches && e.touches[0]) || e;
      lastX = p.clientX; lastY = p.clientY;
    }
    function onPointerMove(e){
      if(!dragging) return;
      const p = (e.touches && e.touches[0]) || e;
      const dx = (p.clientX - lastX) / innerWidth;
      const dy = (p.clientY - lastY) / innerHeight;
      lastX = p.clientX; lastY = p.clientY;
      group.rotation.y += dx * 2.5;
      group.rotation.x += dy * 2.5;
    }
    function onPointerUp(){ dragging = false; }

    container.addEventListener('mousedown', onPointerDown);
    container.addEventListener('mousemove', onPointerMove);
    container.addEventListener('mouseup', onPointerUp);
    container.addEventListener('mouseleave', onPointerUp);
    container.addEventListener('touchstart', onPointerDown, {passive:true});
    container.addEventListener('touchmove', onPointerMove, {passive:true});
    container.addEventListener('touchend', onPointerUp, {passive:true});
    container.addEventListener('touchcancel', onPointerUp, {passive:true});

    let gyroActive = false;
    async function tryEnableGyro(){
      if (gyroActive) return;
      const D = window.DeviceOrientationEvent;
      if (!D) return;
      if (typeof D.requestPermission === 'function'){
        try {
          const res = await D.requestPermission();
          if (res !== 'granted') return;
        } catch(e){ return; }
      }
      window.addEventListener('deviceorientation', (ev)=>{
        const gx = (ev.beta || 0) / 90;
        const gy = (ev.gamma || 0) / 90;
        targetX = gy * 0.35;
        targetY = gx * 0.35;
      });
      gyroActive = true;
    }
    document.getElementById('sphere').addEventListener('click', tryEnableGyro, {once:true});

    // --- Responsive scaling: keep desktop size, scale down on phones ---
    function applyResponsiveScale(){
      const w = container.clientWidth || window.innerWidth;
      const h = container.clientHeight || window.innerHeight;
      const shorter = Math.min(w, h);
      // baseline ~700px; scale down below that, clamp between 0.6 and 1.0
      let s = 1;
      if (shorter < 700) s = shorter / 700;
      s = Math.max(0.6, Math.min(1.0, s));
      group.scale.set(s, s, s);
    }

    function resize(){
      const w = container.clientWidth || window.innerWidth;
      const h = container.clientHeight || window.innerHeight;
      renderer.setSize(w, h, false);
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
      applyResponsiveScale();
    }
    new ResizeObserver(resize).observe(container);
    window.addEventListener('orientationchange', ()=>setTimeout(resize, 250));

    let t = 0;
    function animate(){
      requestAnimationFrame(animate);
      t += 0.005;
      group.rotation.y += 0.0018;
      group.rotation.x += 0.0008;
      group.rotation.y += (targetX - group.rotation.y) * 0.04;
      group.rotation.x += (-targetY - group.rotation.x) * 0.04;
      orbitalGroup.rotation.y += 0.01;
      renderer.render(scene, camera);
    }
    animate();
    resize();
  </script>
</body>
</html>
